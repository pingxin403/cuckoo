apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Metadata
metadata:
  name: monorepo-production
  annotations:
    description: "Production overlay for Monorepo Hello/TODO Services"

# Base configuration
resources:
  - ../../base

# Override namespace for production
namespace: production

# Production-specific annotations
commonAnnotations:
  deployment.kubernetes.io/revision: "1"
  monitoring: "enabled"
  alerting: "enabled"

# Production-specific labels
labels:
  - pairs:
      environment: production
      tier: production

# Override replicas for production
replicas:
  - name: hello-service
    count: 3
  - name: todo-service
    count: 3

# Override images with production registry and tags
images:
  - name: hello-service
    newName: registry.example.com/hello-service
    newTag: v1.0.0
  - name: todo-service
    newName: registry.example.com/todo-service
    newTag: v1.0.0

# ConfigMap generator for production config
configMapGenerator:
  - name: platform-config
    behavior: merge
    literals:
      - ENVIRONMENT=production
      - LOG_LEVEL=warn
      - ENABLE_METRICS=true
      - ENABLE_TRACING=true

# Patches for production-specific changes
patches:
  - path: resources-patch.yaml
  - path: ingress-patch.yaml

# JSON patches for fine-grained changes (optional)
# patchesJson6902:
#   - target:
#       group: apps
#       version: v1
#       kind: Deployment
#       name: hello-service
#     patch: |-
#       - op: replace
#         path: /spec/replicas
#         value: 5
